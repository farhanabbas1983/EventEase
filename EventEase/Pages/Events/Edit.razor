@page "/events/{id:guid}/edit"

@inject EventEase.Services.EventService EventService
@inject NavigationManager Navigation
@inject EventEase.Services.ToastService ToastService

@using EventEase.Models

<PageTitle>Edit Event</PageTitle>

@if (ev is null)
{
    <h3>Event not found</h3>
    <p>The requested event could not be found.</p>
}
else
{
    <h1>Edit @ev.Name</h1>

    <EventForm @bind-EventModel="editEvent" OnValidSubmit="HandleValidSubmit" />
    <div class="mt-3">
        <a class="btn btn-outline-secondary" href="/events/@ev.Id">Cancel</a>
    </div>
}

@code {
    [Parameter]
    public Guid id { get; set; }

    private Event? ev;
    private Event editEvent = new Event();

    protected override void OnParametersSet()
    {
        ev = EventService.GetById(id);
        if (ev != null)
        {
            // create a shallow copy for editing so changes are not applied until saved
            editEvent = new Event { Id = ev.Id, Name = ev.Name, Date = ev.Date, Location = ev.Location };
        }
    }

    private void HandleValidSubmit(Event e)
    {
        if (ev == null) return;
        EventService.UpdateEvent(ev.Id, e);
        ToastService.ShowSuccess("Event updated");
        Navigation.NavigateTo($"/events/{ev.Id}");
    }
}
